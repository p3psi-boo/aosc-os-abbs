From 1607e3a124b512dcad049ae08415a2a815f685d5 Mon Sep 17 00:00:00 2001
From: Chao Li <lichao@loongson.cn>
Date: Wed, 12 Jun 2024 16:49:58 +0800
Subject: [PATCH 25/43] system/usbhcd: Add hwquirk support

Added the hwquirk support for Loongson 7A1000/7A2000 EHCI and execute
the process function if it has been registed.

Signed-off-by: Chao Li <lichao@loongson.cn>
---
 system/usbhcd.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/system/usbhcd.c b/system/usbhcd.c
index 7cf0ea0..bd0e7b3 100644
--- a/system/usbhcd.c
+++ b/system/usbhcd.c
@@ -8,6 +8,7 @@
 #include "usb.h"
 #include "vmem.h"
 #include "boot.h"
+#include "hwquirks.h"
 
 #include "ehci.h"
 #include "ohci.h"
@@ -838,6 +839,10 @@ void find_usb_keyboards(bool pause_if_none)
 
     hci_info_t hci_list[MAX_HCI];
 
+    if ((quirk.type & QUIRK_TYPE_USB) && (quirk.process != NULL)) {
+        quirk.process();
+    }
+
     int num_hci = find_usb_controllers(hci_list);
 
     // Take ownership of all controllers and reset them.
-- 
2.43.4

